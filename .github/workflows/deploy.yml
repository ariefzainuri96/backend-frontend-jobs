name: Deploy to VPS

on:
    push:
        branches:
            - main # Trigger this action only when changes are pushed to the 'main' branch (or any other branch you prefer)

jobs:
    deploy:
        runs-on: ubuntu-latest

        steps:
            # Step 1: Check out the latest code from the repository
            - name: Checkout code
              uses: actions/checkout@v2

            # Step 2: Set up SSH for accessing the VPS
            - name: Set up SSH
              uses: webfactory/ssh-agent@v0.5.3
              with:
                  ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

            # - name: Set up Node.js
            #   uses: actions/setup-node@v2
            #   with:
            #       node-version: '20' # Specify the Node.js version you want to use.

            # - name: Install dependencies
            #   run: npm install

            # Step 3: Deploy to VPS
            - name: Deploy to VPS
              # env:
              #     SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
              run: |
                  ssh -o StrictHostKeyChecking=no root@205.198.87.68 << 'EOF'
                    cd /root/backend/nodejs/backend-frontend-jobs
                    git pull origin main
                    npm install
                    npm run build
                    pm2 stop 0
                    pm2 start 0
                    pm2 startup
                    pm2 save
                  EOF
